# 🍊 マラソン ペースシミュレーター ユーザーマニュアル

このアプリは、**物理モデル（勾配・風・空気抵抗）** に基づき、マラソンコースを「一定の出力（パワー）」で走り切るための最適なペース配分を計算するシミュレーターです。

---

## 🚀 1. 起動方法

ターミナルで以下のコマンドを実行してください。

```bash
python3 -m streamlit run app.py
```

ブラウザが自動的に立ち上がり、アプリが表示されます。

---

## 🛠 2. 使い方（サイドバー設定）

画面左側のサイドバーで、各種設定を行います。

### ① コース設定
*   **コースファイル選択**: `data` フォルダ内にあるGPXファイル（コースデータ）を選択できます。
*   デフォルトで「愛媛マラソン」が入っていますが、他の大会のファイルを追加することも可能です（後述）。

### ② ランナー設定
*   **目標設定モード**:
    *   **目標タイムから逆算**: 「3時間30分切りたい」など、具体的な目標がある場合はこちら。
    *   **VDOTから選択**: 自分のVDOT（ジャック・ダニエルズの走力指標）を知っている場合はこちら。
*   **目標タイム / VDOT**: ターゲットを入力します。

### ③ 気象条件 (予報)
レース当日の予報を入力します。
*   **気温**: 実装予定（現在は参考値）。
*   **風速・風向き**: 海岸線などの「風の影響を受ける区間」で、向かい風ならペースを落とし、追い風なら上げる計算を行います。

### ④ ペース配分戦略 (重要)
単なるイーブンペースだけでなく、戦略的な味付けが可能です。

*   **スプリット配分**:
    *   **イーブン**: 最初から最後まで一定の出力。
    *   **ポジティブ (前半貯金型)**: 前般を少し速く入り、後半粘る型。
    *   **ネガティブ (後半追い上げ型)**: 前半を温存し、30km以降で上げる型。
    
*   **上り坂のパワー設定 (平地比 %)**:
    *   **100% (デフォルト)**: 坂道でも平地と同じ出力で走ります（ペースは落ちますが、後半に脚が残ります）。
    *   **100%超 (頑張る)**: 上り坂で出力を上げます。タイムは稼げますが、エネルギーを前借りするため、下り坂や平地で休む必要があります。
    *   **100%未満 (楽をする)**: 上り坂で力を抜きます。温存したエネルギーを使って、下り坂でスピードに乗れます。

---

## 📊 3. 結果の見方

### ペース戦略チャート
*   **赤線 (推奨ペース)**: あなたが走るべきペース配分です。
*   **グレーの影**: コースの標高プロファイルです。
*   山がある場所で赤線が下がっている（遅くなっている）のは、一定パワーを維持した結果です。

### 推奨ラップ表
*   1kmごとの区間タイム、累積タイム、推奨ペースが表示されます。
*   これをプリントアウトしたり、スポーツウォッチの参考にしてください。

---

## 📂 4. 新しいコースの追加方法

自分の走る大会のデータを追加できます。

1.  該当する大会の **GPXファイル** を入手します（Web上のコース共有サイトや、以前走ったログなど）。
2.  このプロジェクトの **`data`** フォルダの中に、GPXファイルをコピーします。
3.  アプリをリロードすると、サイドバーの「コースファイル選択」に新しいファイルが表示されます。

※ **補正機能**: 読み込んだGPXの距離が40kmを超えている場合、自動的に**42.195km**に補正（伸縮）して計算します。距離が少し長い/短いログでも安心して使えます。

---

## 💡 5. よくある質問 (Q&A)

**Q. 体重設定がありませんが？**
A. シンプル化のため、内部的に標準体重（60kg）で計算しています。体重による空気抵抗のスケーリング（重い人は面積も広い）を導入しているため、個別の体重入力がなくてもペース配分の傾向（どこで速く走るべきか）は正しく算出されます。

**Q. ラップ表のタイムが速すぎたり遅すぎたりする区間がある**
A. 「5m刻み」で詳細に計算しているため、短い激坂などがある区間はその影響が反映されます。また、データ欠損（トンネル等）があった場所は平地として補正しています。

**Q. 「上り坂パワー」を上げたら予想タイムが遅くなった**
A. 正常な挙動です。上り坂で無理をしてエネルギーを使いすぎると、残りの長い距離でペースを落とさざるを得なくなり（回復のため）、トータルでは遅くなることがあります。「頑張りすぎない」ことの重要性を示しています。
