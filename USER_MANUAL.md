# 🍊 マラソン攻略シミュレーター ユーザーマニュアル (β0.1)

このアプリは、**物理モデル（勾配・風・空気抵抗）** に基づき、マラソンコースを「一定の出力（パワー）」で走り切るための最適なペース配分を計算するシミュレーターです。

---

## 🚀 1. 起動方法

ターミナルで以下のコマンドを実行してください。

```bash
python3 -m streamlit run app.py
```

ブラウザが自動的に立ち上がり、アプリが表示されます。

---

## 🛠 2. 使い方（サイドバー設定）

画面左側のサイドバーで、各種設定を行います。

### ① 基礎走力の設定
あなたの現在の走力を入力します。以下の2つのモードから選択できます。

*   **VDOT**: 自身のVDOT（ジャック・ダニエルズの走力指標）を直接入力します。
*   **フルマラソンタイム**: 目標とする、または現在の実力のフルマラソンタイム（例: 3:30:00）を入力します。これからVDOTを逆算します。

### ② コース選択
*   **コースファイル**: `data` フォルダに保存されたGPXファイルからコースを選択します。（デフォルト: 愛媛マラソン2025など）

### ③ 環境条件の設定
レース当日の予報を入力します。
*   **風速 (m/s)**: 当日の予報風速を入力します。
    *   ※内部計算では、地表摩擦や遮蔽物を考慮し、入力値の **50%** を実効風速として計算します。
*   **風向き**: 風が吹いてくる方位を選択します。

### ④ 詳細設定 (開発者用)
Garmin Connectなどの比較対象データと「獲得標高」を合わせ込むための調整機能です。通常はデフォルトのままで構いません。
*   **標高データの平滑化範囲 (m)**: 
    *   GPXデータの標高ノイズをどれくらい「ならす」かを設定します。
    *   値を大きくすると細かいアップダウンが無視され、獲得標高が小さくなります。
    *   Garmin等は比較的強い補正がかかっているため、130m〜200m程度で一致することが多いです。
    *   **0m** に設定すると平滑化なし（生データ）で計算されます。

### ⑤ レース戦略の選択
*   **スプリット配分**:
    *   `イーブン`: 一定の出力感（ペース）を維持します。
    *   `ポジティブ`: 前半に貯金を作る（後半タレることを許容する）戦略です。
    *   `ネガティブ`: 後半に追い上げる（前半を抑える）戦略です。
*   **上り坂のパワー設定**:
    *   `100%`: 坂道でも平地と同じ出力（努力感）を維持します（ペースは落ちます）。
    *   `>100%` (頑張る): 坂道で出力を上げます。タイムは稼げますが後半の消耗リスクがあります。
    *   `<100%` (楽をする): 坂道は無理せず、下りや平地で稼ぐ戦略です。

### シミュレーション実行
全ての設定完了後、一番下の **赤いボタン「🚀 シミュレーション実行」** をクリックしてください。

---

## 📊 3. 結果の見方

シミュレーションが完了すると、メイン画面に以下の情報が表示されます。

### クイックサマリー
1.  **シミュレーション結果：予想タイム**: ゴール予測タイムです。
2.  **シミュレーション結果：平均ペース**: 全体の平均ペースです。
3.  **基礎走力（平地相当ペース）**: このコースを走る強度が、「平坦なコース」でいうとどのくらいのペース（VDOT強度）に相当するかを示します。

### 📈 ペース戦略チャート
*   **赤線 (平均ペース)**: 推奨されるペース配分（分/km）です。
    *   チャート上部のチェックボックス **「チャートの平滑化」** をONにすると、トレンドが見やすくなります。
    *   山なりになっている部分は、上り坂などでペースを落とすべき区間です。
*   **グレー背景**: コースの標高プロファイル（起伏）です。

### 🗺️ コース平面図
*   コースの地図とルートが表示されます。
*   自動的にコース全体が見やすいサイズにズーム調整されます。

### 📋 シミュレーション結果：区間ラップ表（1km毎）
*   1kmごとの推奨ラップタイム一覧です。
*   **目標スプリット**（通過タイム）も併記されているので、バンド等にメモして活用してください。
*   最後の区間は `42 - 42.195 km` と正確に表示されます。

---

## ⚔️ 4. コース比較機能

画面下部の **「📊 コース比較」** セクションでは、現在の設定（走力・戦略・気象）そのままで、別のコースを走ったシミュレーションを行えます。

1.  ドロップダウンから**比較対象のコース**（例：東京マラソン等）を選択します。
2.  **「コース比較を実行」** ボタンを押します。
3.  以下の指標で、現在のコースとの違いが表示されます：
    *   **予想タイム**: どのくらい速い/遅いか。
    *   **獲得標高**: 累積で登る高さの違い。
    *   **コース難易度 (Toughness)**: 独自の難易度スコア（100 + 獲得標高/10）による比較。

---

## 💡 5. よくある質問 (Q&A)

**Q. 体重設定がありませんが？**
A. シンプル化のため、内部的に標準体重（60kg）で計算しています。体重による空気抵抗のスケーリング（重い人は面積も広い）を導入しているため、個別の体重入力がなくてもペース配分の傾向（どこで速く走るべきか）は正しく算出されます。

**Q. ラップ表のタイムが速すぎたり遅すぎたりする区間がある**
A. 「5m刻み」で詳細に計算しているため、短い激坂などがある区間はその影響が反映されます。また、データ欠損（トンネル等）があった場所は平地として補正しています。

**Q. 「上り坂パワー」を上げたら予想タイムが遅くなった**
A. 正常な挙動です。上り坂で無理をしてエネルギーを使いすぎると、残りの長い距離でペースを落とさざるを得なくなり（回復のため）、トータルでは遅くなることがあります。「頑張りすぎない」ことの重要性を示しています。
